<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>LSTDAQ: LSTDAQ::RingBuffer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LSTDAQ
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceLSTDAQ.html">LSTDAQ</a></li><li class="navelem"><a class="el" href="classLSTDAQ_1_1RingBuffer.html">RingBuffer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classLSTDAQ_1_1RingBuffer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">LSTDAQ::RingBuffer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The class to organize ringbuffer.  
 <a href="classLSTDAQ_1_1RingBuffer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="RingBuffer_8hpp_source.html">RingBuffer.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a73c8c103abb16180f8287045a1a3c991"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a73c8c103abb16180f8287045a1a3c991">RingBuffer</a> ()  throw ()</td></tr>
<tr class="memdesc:a73c8c103abb16180f8287045a1a3c991"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a73c8c103abb16180f8287045a1a3c991">More...</a><br /></td></tr>
<tr class="separator:a73c8c103abb16180f8287045a1a3c991"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93d7015f6225d9e37fddff92aef0a8b9"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a93d7015f6225d9e37fddff92aef0a8b9">~RingBuffer</a> ()  throw ()</td></tr>
<tr class="memdesc:a93d7015f6225d9e37fddff92aef0a8b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor.  <a href="#a93d7015f6225d9e37fddff92aef0a8b9">More...</a><br /></td></tr>
<tr class="separator:a93d7015f6225d9e37fddff92aef0a8b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a018ba5a5649552fe28a226486becf9c8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLSTDAQ_1_1RingBuffer.html">RingBuffer</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a018ba5a5649552fe28a226486becf9c8">operator=</a> (const <a class="el" href="classLSTDAQ_1_1RingBuffer.html">RingBuffer</a> &amp;)  throw ()</td></tr>
<tr class="memdesc:a018ba5a5649552fe28a226486becf9c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">"=" operator  <a href="#a018ba5a5649552fe28a226486becf9c8">More...</a><br /></td></tr>
<tr class="separator:a018ba5a5649552fe28a226486becf9c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa74541deb15ec24ed7cf50f22b3d8376"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#aa74541deb15ec24ed7cf50f22b3d8376">open</a> ()</td></tr>
<tr class="separator:aa74541deb15ec24ed7cf50f22b3d8376"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c6cee9d706927ec698eca7ee06586b2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a1c6cee9d706927ec698eca7ee06586b2">init</a> ()</td></tr>
<tr class="separator:a1c6cee9d706927ec698eca7ee06586b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e5dd48d737d2a7cdc8e53baa97900eb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a6e5dd48d737d2a7cdc8e53baa97900eb">write</a> (char *buf, unsigned int wbytes)</td></tr>
<tr class="memdesc:a6e5dd48d737d2a7cdc8e53baa97900eb"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function to write data on <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a> in which wbytes[bytes] of data from *buf will be written.  <a href="#a6e5dd48d737d2a7cdc8e53baa97900eb">More...</a><br /></td></tr>
<tr class="separator:a6e5dd48d737d2a7cdc8e53baa97900eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a589fb1045d27590cca235e01f313d1e8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a589fb1045d27590cca235e01f313d1e8">read</a> (char *buf)</td></tr>
<tr class="memdesc:a589fb1045d27590cca235e01f313d1e8"><td class="mdescLeft">&#160;</td><td class="mdescRight">The function to read data from <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a>.  <a href="#a589fb1045d27590cca235e01f313d1e8">More...</a><br /></td></tr>
<tr class="separator:a589fb1045d27590cca235e01f313d1e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2bbd20a28f7dcf14388648f0eb092cd"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#ac2bbd20a28f7dcf14388648f0eb092cd">getNw</a> ()  throw ()</td></tr>
<tr class="separator:ac2bbd20a28f7dcf14388648f0eb092cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d7d68084f66a4fc1c6279171b778807"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classLSTDAQ_1_1RingBuffer.html#a9d7d68084f66a4fc1c6279171b778807">getNr</a> ()  throw ()</td></tr>
<tr class="separator:a9d7d68084f66a4fc1c6279171b778807"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The class to organize ringbuffer. </p>
<p>Ringbuffer is a buffer to temporally store data which arrive at socket through TCP/IP.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">-Name-</td><td>&mdash;Type : Description&mdash;</td></tr>
    <tr><td class="paramname">*****For_access_controll*****</td><td></td></tr>
    <tr><td class="paramname">m_mutex</td><td>pthread_mutex_t : ticket to access <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a> object </td></tr>
    <tr><td class="paramname">m_cond</td><td>pthread_cond_t : to controll pthread_mutex_t so that a thread who has ticket can wait for and allow another thread access <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a> object. </td></tr>
    <tr><td class="paramname">m_tsWait</td><td>struct timespec : time to wait (on write function)</td></tr>
    <tr><td class="paramname">*****Buffer*****</td><td></td></tr>
    <tr><td class="paramname">m_buffer[EVENTSIZE*RINGBUFSIZE]</td><td>unsigned char : buffer memory. RINGBUFSIZE and EVENTSIZE are defined in <a class="el" href="RingBuffer_8hpp.html">RingBuffer.hpp</a> and <a class="el" href="Config_8hpp.html">Config.hpp</a> respectively. </td></tr>
    <tr><td class="paramname">RINGBUFSIZE</td><td>#define : size of the buffer[events]. </td></tr>
    <tr><td class="paramname">EVENTSIZE</td><td>#define : size of one event[bytes]. More precisely, the length of data which comes from a FEB kicked by a trigger.</td></tr>
    <tr><td class="paramname">m_Nm</td><td>const unsigned int : NOT USED. TO BE REMOVED. (confession: this was used to check initialization by constructor in developing this program)</td></tr>
    <tr><td class="paramname">*****For_position_controll*****</td><td></td></tr>
    <tr><td class="paramname">m_bufSizeByte</td><td>unsigned int : buffer size[byte] to be used as reference to the position in <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a>. It is initialized as m_bufSizeByte = RINGBUFSIZE*EVENTSIZE. </td></tr>
    <tr><td class="paramname">m_Nmw</td><td>unsigned int :position[events] to write on the memory </td></tr>
    <tr><td class="paramname">m_Nmr</td><td>unsigned int :position[events] to read from the memory </td></tr>
    <tr><td class="paramname">m_woffset</td><td>unsigned int :pointer position[bytes] to write on the memory </td></tr>
    <tr><td class="paramname">m_roffset</td><td>unsigned int :pointer position[bytes] to read from the memory </td></tr>
    <tr><td class="paramname">m_remain</td><td>unsigned int : </td></tr>
    <tr><td class="paramname">m_wbytes</td><td>unsigned int :The data size of current event, which have been written to the memory. 0 =&lt; m_wbytes &lt; EVENTSIZE.</td></tr>
    <tr><td class="paramname">*****Total_history*****</td><td></td></tr>
    <tr><td class="paramname">m_Nw</td><td>unsigned long : Total number of events written to the memory </td></tr>
    <tr><td class="paramname">m_Nr</td><td>unsigned long : Total number of events read from the memory </td></tr>
  </table>
  </dd>
</dl>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a73c8c103abb16180f8287045a1a3c991"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LSTDAQ::RingBuffer::RingBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
        <tr>
          <td align="right">throw </td><td>(</td><td colspan="2"></td>
        </tr>
        <tr>
          <td align="right"></td><td>)</td><td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>

</div>
</div>
<a class="anchor" id="a93d7015f6225d9e37fddff92aef0a8b9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">LSTDAQ::RingBuffer::~RingBuffer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
        <tr>
          <td align="right">throw </td><td>(</td><td colspan="2"></td>
        </tr>
        <tr>
          <td align="right"></td><td>)</td><td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a9d7d68084f66a4fc1c6279171b778807"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long LSTDAQ::RingBuffer::getNr </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
        <tr>
          <td align="right">throw </td><td>(</td><td colspan="2"></td>
        </tr>
        <tr>
          <td align="right"></td><td>)</td><td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ac2bbd20a28f7dcf14388648f0eb092cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long LSTDAQ::RingBuffer::getNw </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
        <tr>
          <td align="right">throw </td><td>(</td><td colspan="2"></td>
        </tr>
        <tr>
          <td align="right"></td><td>)</td><td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a1c6cee9d706927ec698eca7ee06586b2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool LSTDAQ::RingBuffer::init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="aa74541deb15ec24ed7cf50f22b3d8376"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool LSTDAQ::RingBuffer::open </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a018ba5a5649552fe28a226486becf9c8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLSTDAQ_1_1RingBuffer.html">RingBuffer</a> &amp; LSTDAQ::RingBuffer::operator= </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classLSTDAQ_1_1RingBuffer.html">RingBuffer</a> &amp;&#160;</td>
          <td class="paramname"><em>rb</em></td><td>)</td>
          <td></td>
        </tr>
        <tr>
          <td align="right">throw </td><td>(</td><td colspan="2"></td>
        </tr>
        <tr>
          <td align="right"></td><td>)</td><td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>"=" operator </p>

</div>
</div>
<a class="anchor" id="a589fb1045d27590cca235e01f313d1e8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LSTDAQ::RingBuffer::read </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function to read data from <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a>. </p>
<p>Whole size of one event data is read from m_buffer. If there is no new data in m_buffer, the function ends without reading.</p>
<p>Procedure :</p><ul>
<li>If there is no new unread data, the function ends.</li>
<li>Lock mutex</li>
<li>read one event starts from m_roffset in m_buffer.</li>
<li>increment values (m_Nr, m_Nmr and m_roffset).</li>
<li>If offset in m_roffset reaches at the end of m_buffer, resets m_Nmr and m_roffset. </li>
</ul>

</div>
</div>
<a class="anchor" id="a6e5dd48d737d2a7cdc8e53baa97900eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int LSTDAQ::RingBuffer::write </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>wbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The function to write data on <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a> in which wbytes[bytes] of data from *buf will be written. </p>
<p>Data with any length up to EVENTSIZE can be written if there is enough empty space. "empty" space means the buffer memory which is not written yet or already read by <a class="el" href="classLSTDAQ_1_1RingBuffer.html#a589fb1045d27590cca235e01f313d1e8" title="The function to read data from RingBuffer. ">read()</a> function. Data doesn't need to be exact within one event. Data which contains parts of two events can be treated too.</p>
<p>Procedure:</p><ul>
<li>Lock mutex so that no other threads can access <a class="el" href="classLSTDAQ_1_1RingBuffer.html" title="The class to organize ringbuffer. ">RingBuffer</a>.</li>
<li>Makes sure there is enough space to write <br />
 m_Nw should not be larger than m_Nr + RINGBUFSIZE, otherwise the unread data in buffer is overwritten. If the condition will be violated by writing data, this function stops and waits for one more data to be read.</li>
<li>Writes data in m_buffer buffer memory<br />
 The data buf with wbytes of lengh is written to m_buffer from m_woffset position. After writing, m_woffset and m_wbytes will be increased by wbytes. ã€€If the data to write doesn't include the end of a event (m_wbytes + wbytes&lt; EVENTSIZE), data will just be written. Otherwise, data will be written in following way.<br />
 m_Nw and m_Nmw will be counted up as well as data is written in buffer and m_woffset will be shifted by wbytes.m_wbytes also be shifted so that it indicates to which position in the dataformat has been written. If the position in the memory to write data includes the end of buffer memory, the process includes reset of the offset position. This means m_Nmw=0 and m_woffset = m_remain. m_remain is the residure to write after writing data until the end position of buffer.</li>
<li>Unlock mutex to access. </li>
</ul>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/<a class="el" href="RingBuffer_8hpp_source.html">RingBuffer.hpp</a></li>
<li>src/<a class="el" href="RingBuffer_8cpp.html">RingBuffer.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
